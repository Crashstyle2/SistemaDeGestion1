<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Recorridos Múltiples</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 10px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .multiple { background-color: #e8f5e8; }
        .single { background-color: #f8f8f8; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        #loading { display: none; }
    </style>
</head>
<body>
    <h1>Debug: Recorridos Múltiples</h1>
    <button onclick="debugRecorridos()">Ejecutar Debug</button>
    <div id="loading">Cargando...</div>
    <div id="results"></div>

    <script>
        function debugRecorridos() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').innerHTML = '';
            
            // Crear un iframe oculto para ejecutar el PHP
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = 'debug_recorridos.php';
            
            iframe.onload = function() {
                document.getElementById('loading').style.display = 'none';
                try {
                    const content = iframe.contentDocument.body.innerHTML;
                    document.getElementById('results').innerHTML = content;
                } catch (e) {
                    document.getElementById('results').innerHTML = '<p class="error">Error al cargar el debug: ' + e.message + '</p>';
                }
            };
            
            iframe.onerror = function() {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').innerHTML = '<p class="error">Error al ejecutar el script de debug</p>';
            };
            
            document.body.appendChild(iframe);
        }
        
        // También intentar con AJAX
        function debugConAjax() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'debug_recorridos.php', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4) {
                    document.getElementById('loading').style.display = 'none';
                    if (xhr.status === 200) {
                        document.getElementById('results').innerHTML = xhr.responseText;
                    } else {
                        document.getElementById('results').innerHTML = '<p class="error">Error HTTP: ' + xhr.status + '</p>';
                    }
                }
            };
            xhr.send();
        }
    </script>
    
    <hr>
    <h2>Análisis Manual</h2>
    <p>Si el debug automático no funciona, aquí hay algunas verificaciones manuales:</p>
    
    <h3>1. Verificar en ver_registros.php</h3>
    <p>Buscar en el código si:</p>
    <ul>
        <li>La consulta SQL incluye LEFT JOIN con uso_combustible_recorridos</li>
        <li>La variable $isMultiple se calcula correctamente</li>
        <li>Los botones expand-btn se generan cuando $isMultiple es true</li>
        <li>Los contenedores sub-records-container tienen el data-group correcto</li>
    </ul>
    
    <h3>2. Verificar en la base de datos</h3>
    <p>Ejecutar estas consultas SQL:</p>
    <pre>
-- Contar registros en uso_combustible
SELECT COUNT(*) FROM uso_combustible;

-- Contar registros en uso_combustible_recorridos
SELECT COUNT(*) FROM uso_combustible_recorridos;

-- Buscar registros con múltiples recorridos
SELECT uc.id, COUNT(ucr.id) as total_recorridos
FROM uso_combustible uc 
LEFT JOIN uso_combustible_recorridos ucr ON uc.id = ucr.uso_combustible_id 
GROUP BY uc.id 
HAVING total_recorridos > 1;
    </pre>
    
    <h3>3. Verificar en el navegador</h3>
    <p>En la página ver_registros.php:</p>
    <ul>
        <li>Abrir las herramientas de desarrollador (F12)</li>
        <li>Buscar elementos con clase 'expand-btn'</li>
        <li>Verificar si tienen el atributo data-group</li>
        <li>Buscar elementos con clase 'sub-records-container'</li>
        <li>Verificar si el JavaScript se está ejecutando correctamente</li>
    </ul>
</body>
</html>